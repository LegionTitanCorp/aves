<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>¿Qué Ave Es? - Juego de Adivinanza</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        min-height: 100vh;
        color: #2d3748;
        line-height: 1.6;
        padding: 20px;
        position: relative;
        overflow-x: hidden;
    }

    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="25" cy="25" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="3" fill="rgba(255,255,255,0.05)"/><circle cx="50" cy="10" r="1" fill="rgba(255,255,255,0.15)"/></svg>');
        animation: float 20s infinite linear;
        pointer-events: none;
        z-index: -1;
    }

    @keyframes float {
        0% { transform: translateY(0) rotate(0deg); }
        100% { transform: translateY(-100vh) rotate(360deg); }
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        box-shadow: 
            0 25px 50px rgba(0, 0, 0, 0.15),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        overflow: hidden;
        position: relative;
    }

    .container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
        animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    header {
        text-align: center;
        padding: 40px;
        background: linear-gradient(135deg, 
            rgba(102, 126, 234, 0.1) 0%, 
            rgba(118, 75, 162, 0.1) 50%, 
            rgba(240, 147, 251, 0.1) 100%);
        position: relative;
    }

    h1 {
        font-size: clamp(2rem, 5vw, 3.5rem);
        font-weight: 800;
        margin-bottom: 12px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: none;
        animation: titlePulse 3s ease-in-out infinite;
    }

    @keyframes titlePulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.02); }
    }

    .subtitle {
        font-size: 1.3rem;
        color: #64748b;
        font-weight: 500;
        opacity: 0.8;
        animation: fadeInUp 1s ease-out;
    }

    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 0.8; transform: translateY(0); }
    }

    /* Modal para nombre de jugador */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
    }

    .modal-content {
        background: white;
        padding: 30px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
    }

    .modal-content input {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        margin: 15px 0;
        outline: none;
        transition: border-color 0.3s;
    }

    .modal-content input:focus {
        border-color: #667eea;
    }

    /* Leaderboard */
    .leaderboard {
        position: fixed;
        top: 70px;
        right: 20px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        min-width: 250px;
        z-index: 100;
        transition: transform 0.3s ease;
    }

    .leaderboard.hidden {
        transform: translateX(100%);
    }

    .leaderboard h3 {
        margin-bottom: 15px;
        color: #475569;
        font-size: 18px;
        text-align: center;
        border-bottom: 2px solid #e2e8f0;
        padding-bottom: 10px;
    }

    .leaderboard-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        margin: 5px 0;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 8px;
        font-size: 14px;
    }

    .leaderboard-item.current {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        font-weight: bold;
    }

    .leaderboard-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 16px;
        border-radius: 50px;
        cursor: pointer;
        z-index: 101;
        font-weight: 600;
        font-size: 14px;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        transition: all 0.3s ease;
    }

    .leaderboard-toggle:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
    }

    .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 20px;
        margin: 30px 20px;
    }

    .stat-item {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.6));
        backdrop-filter: blur(10px);
        padding: 24px 20px;
        border-radius: 16px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .stat-item::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(102, 126, 234, 0.1), transparent);
        transform: rotate(45deg);
        transition: all 0.6s;
        opacity: 0;
    }

    .stat-item:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }

    .stat-item:hover::before {
        opacity: 1;
        animation: shine 0.6s ease-in-out;
    }

    @keyframes shine {
        0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 900;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 8px;
        display: block;
        animation: countUp 0.8s ease-out;
    }

    @keyframes countUp {
        from { transform: scale(0); }
        to { transform: scale(1); }
    }

    .stat-label {
        font-size: 0.95rem;
        color: #64748b;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1.2px;
    }

    .difficulty-selector {
        margin: 30px 20px;
        text-align: center;
        animation: slideInLeft 1s ease-out;
    }

    .difficulty-selector h3 {
        font-size: 1.4rem;
        margin-bottom: 20px;
        color: #475569;
        font-weight: 700;
    }

    .difficulty-btn {
        margin: 8px;
        padding: 12px 24px;
        font-size: 14px;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.8);
        border: 2px solid rgba(102, 126, 234, 0.3);
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        overflow: hidden;
    }

    .difficulty-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: all 0.5s;
    }

    .difficulty-btn:hover::before {
        left: 100%;
    }

    .difficulty-btn:hover {
        transform: translateY(-2px);
        border-color: rgba(102, 126, 234, 0.6);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    .difficulty-btn.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border-color: transparent;
        box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
    }

    .game-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        padding: 30px;
    }

    @media (max-width: 768px) {
        .game-container {
            grid-template-columns: 1fr;
        }
    }

    .bird-image-container {
        position: relative;
        animation: slideInLeft 1s ease-out;
    }

    .bird-image {
        width: 100%;
        height: 350px;
        border-radius: 20px;
        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 6rem;
        color: #cbd5e1;
        position: relative;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .bird-image::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, 
            rgba(102, 126, 234, 0.1), 
            transparent, 
            rgba(118, 75, 162, 0.1));
        opacity: 0;
        transition: opacity 0.3s;
    }

    .bird-image:hover::before {
        opacity: 1;
    }

    .blurred {
        filter: blur(15px) brightness(0.7);
    }

    .reveal-btn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 12px 24px;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
        backdrop-filter: blur(10px);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 10;
        opacity: 1;
    }

    .reveal-btn:hover {
        transform: translate(-50%, -50%) scale(1.05);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    }

    .reveal-btn.used {
        opacity: 0.5;
        pointer-events: none;
        background: #94a3b8;
    }

    .game-info {
        animation: slideInRight 1s ease-out;
    }

    .clues-container {
        background: linear-gradient(135deg, rgba(248, 250, 252, 0.9), rgba(241, 245, 249, 0.9));
        backdrop-filter: blur(10px);
        padding: 24px;
        border-radius: 20px;
        margin-bottom: 24px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .clues-container h3 {
        font-size: 1.4rem;
        margin-bottom: 20px;
        color: #475569;
        font-weight: 700;
    }

    .clue {
        margin-bottom: 16px;
        padding: 16px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(102, 126, 234, 0.1);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 0.3;
        transform: translateX(-20px);
        position: relative;
        overflow: hidden;
    }

    .clue.revealed {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.05));
        border-color: rgba(102, 126, 234, 0.3);
        opacity: 1;
        transform: translateX(0);
        animation: revealClue 0.6s ease-out;
    }

    .clue.countdown {
        animation: clueCountdown 10s linear forwards;
    }

    @keyframes clueCountdown {
        0% { opacity: 1; }
        80% { opacity: 1; }
        100% { opacity: 0.3; }
    }

    .clue::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        background: linear-gradient(90deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
        width: 0;
        transition: width 0.3s ease;
    }

    .clue.countdown::after {
        animation: progressBar 10s linear forwards;
    }

    @keyframes progressBar {
        0% { width: 0%; }
        100% { width: 100%; }
    }

    @keyframes revealClue {
        from { 
            opacity: 0; 
            transform: translateY(-10px) scale(0.95); 
        }
        to { 
            opacity: 1; 
            transform: translateY(0) scale(1); 
        }
    }

    .clue-number {
        font-weight: 800;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-right: 8px;
        font-size: 1.1rem;
    }

    .options-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }

    .option {
        padding: 20px 16px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.9));
        backdrop-filter: blur(10px);
        border: 2px solid rgba(102, 126, 234, 0.2);
        border-radius: 16px;
        cursor: pointer;
        text-align: center;
        font-weight: 600;
        font-size: 15px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .option::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
        transition: all 0.5s;
    }

    .option:hover {
        transform: translateY(-4px) scale(1.02);
        border-color: rgba(102, 126, 234, 0.5);
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.2);
    }

    .option:hover::before {
        left: 100%;
    }

    .option.correct {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(21, 128, 61, 0.1));
        border-color: rgb(34, 197, 94);
        color: rgb(21, 128, 61);
        animation: correctAnswer 0.6s ease-out;
    }

    @keyframes correctAnswer {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .option.incorrect {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(185, 28, 28, 0.1));
        border-color: rgb(239, 68, 68);
        color: rgb(185, 28, 28);
        animation: incorrectAnswer 0.6s ease-out;
    }

    @keyframes incorrectAnswer {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }

    .controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 24px 0;
        flex-wrap: wrap;
    }

    button {
        padding: 16px 32px;
        font-size: 16px;
        cursor: pointer;
        border: none;
        border-radius: 50px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        position: relative;
        overflow: hidden;
    }

    button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: all 0.5s;
    }

    button:hover::before {
        left: 100%;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }

    .btn-secondary {
        background: linear-gradient(135deg, #f093fb, #f5576c);
        color: white;
    }

    button:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
    }

    button:active {
        transform: translateY(-1px) scale(0.98);
    }

    .feedback {
        text-align: center;
        font-weight: 600;
        font-size: 16px;
        padding: 20px;
        border-radius: 16px;
        margin: 20px 0;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .feedback.success {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(21, 128, 61, 0.1));
        color: rgb(21, 128, 61);
        box-shadow: 0 12px 30px rgba(34, 197, 94, 0.3);
        animation: successPulse 0.6s ease-out;
    }

    @keyframes successPulse {
        0% { transform: scale(0.9); opacity: 0; }
        50% { transform: scale(1.02); }
        100% { transform: scale(1); opacity: 1; }
    }

    .feedback.info {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.1));
        color: #475569;
        box-shadow: 0 12px 30px rgba(102, 126, 234, 0.2);
    }

    .feedback.error {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(185, 28, 28, 0.1));
        color: rgb(185, 28, 28);
        box-shadow: 0 12px 30px rgba(239, 68, 68, 0.3);
        animation: errorShake 0.6s ease-out;
    }

    @keyframes errorShake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
    }

    .hint-btn {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: white;
        position: relative;
    }

    .hint-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
    }

    /* Animaciones de entrada */
    @keyframes slideInLeft {
        from { opacity: 0; transform: translateX(-50px); }
        to { opacity: 1; transform: translateX(0); }
    }

    @keyframes slideInRight {
        from { opacity: 0; transform: translateX(50px); }
        to { opacity: 1; transform: translateX(0); }
    }

    /* Efectos de partículas para respuestas correctas */
    .particle {
        position: absolute;
        width: 6px;
        height: 6px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        border-radius: 50%;
        pointer-events: none;
        animation: particle 1s ease-out forwards;
    }

    @keyframes particle {
        0% {
            opacity: 1;
            transform: scale(1) translate(0, 0);
        }
        100% {
            opacity: 0;
            transform: scale(0) translate(var(--x), var(--y));
        }
    }

    /* Responsive design */
    @media (max-width: 480px) {
        .stats {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .options-container {
            grid-template-columns: 1fr;
        }
        
        .controls {
            flex-direction: column;
            align-items: center;
        }
        
        button {
            width: 100%;
            max-width: 280px;
        }

        .leaderboard {
            top: auto;
            right: auto;
            margin: 20px 0;
            width: 90%;
        }

        .leaderboard-toggle {
            align-content: center;
            width: 50%;
            margin-right: 70px;
        }
    }

    /* Loading animation */
    .loading {
        opacity: 0.6;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 0.6; }
        50% { opacity: 0.3; }
    }
</style>
</head>
<body>

<!-- Modal para nombre de jugador -->
<div id="playerModal" class="modal">
    <div class="modal-content">
        <h2>¡Bienvenido al Juego de Aves!</h2>
        <p>Ingresa tu nombre para comenzar:</p>
        <input type="text" id="playerName" placeholder="Tu nombre" maxlength="20">
        <button class="btn-primary" onclick="startGame()">Comenzar Juego</button>
    </div>
</div>

<!-- Toggle del Leaderboard -->
<button class="leaderboard-toggle" onclick="toggleLeaderboard()">🏆 Ranking</button>

<!-- Leaderboard -->
<div id="leaderboard" class="leaderboard hidden">
    <h3 id="leaderboardTitle">Top Jugadores - Fácil</h3>
    <div id="leaderboardList">
        <!-- Se llena con JavaScript -->
    </div>
</div>

<div class="container">
    <header>
        <h1>¿Qué Ave Es?</h1>
        <p class="subtitle">Adivina el ave basándote en las pistas proporcionadas</p>
    </header>

    <div class="stats">
        <div class="stat-item">
            <div class="stat-number" id="score">0</div>
            <div class="stat-label">Puntuación</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="correct-answers">0</div>
            <div class="stat-label">Correctas</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="hints-used">0</div>
            <div class="stat-label">Pistas Usadas</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="streak">0</div>
            <div class="stat-label">Racha Actual</div>
        </div>
    </div>

    <div class="difficulty-selector">
        <h3>Nivel de Dificultad:</h3>
        <button class="difficulty-btn active" onclick="setDifficulty('easy')">Fácil (3 opciones)</button>
        <button class="difficulty-btn" onclick="setDifficulty('medium')">Medio (4 opciones)</button>
        <button class="difficulty-btn" onclick="setDifficulty('hard')">Difícil (6 opciones)</button>
    </div>

    <div class="game-container">
        <div class="bird-image-container">
            <div class="bird-image blurred" id="bird-image">
                🐦
            </div>
            <button class="reveal-btn" id="revealBtn" onclick="revealImage()">Revelar Imagen</button>
        </div>

        <div class="game-info">
            <div class="clues-container">
                <h3>Pistas:</h3>
                <div class="clue" id="clue-1"><span class="clue-number">1.</span> <span id="clue-1-text"></span></div>
                <div class="clue" id="clue-2"><span class="clue-number">2.</span> <span id="clue-2-text"></span></div>
                <div class="clue" id="clue-3"><span class="clue-number">3.</span> <span id="clue-3-text"></span></div>
                <div class="clue" id="clue-4"><span class="clue-number">4.</span> <span id="clue-4-text"></span></div>
            </div>

            <div class="feedback info" id="feedback">
                ¡Selecciona una opción para adivinar!
            </div>

            <div class="options-container" id="options-container">
                <!-- Las opciones se generarán con JavaScript -->
            </div>

            <div class="controls">
                <button class="btn-primary" onclick="nextBird()">Siguiente Ave</button>
                <button class="btn-secondary hint-btn" onclick="useHint()" id="hint-btn">Usar Pista</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Base de datos de aves mejorada
    const avesData = {
        1: { // Águila ratonera pechinegra
        nombre: 'Aguila ratonera pechinegra',
        nombreCientifico: 'Geranoaetus melanoleucus',
        descripcion: 'Ave rapaz de gran tamaño que habita en las montañas andinas. Se caracteriza por su vuelo aerodinámico y excelente aislamiento térmico que le permite vivir en altitudes elevadas.',
        habitat: 'Montañas andinas, páramos y zonas rocosas',
        tamaño: '60-70 cm',
        peso: '1.8-2.5 kg',
        icono: '🦅',
        categoria: 'Rapaz',
        imagen: 'imagenes/Aguila-ratonera.png'
    },

    2: { // Aguilucho Negro
        nombre: 'Aguilucho Negro',
        nombreCientifico: '-',
        descripcion: 'Ave rapaz elegante conocida por su vuelo aerodinámico. Su plumaje oscuro le permite camuflarse entre las rocas andinas mientras caza.',
        habitat: 'Zonas montañosas y valles andinos',
        tamaño: '55-65 cm',
        peso: '1.2-1.8 kg',
        icono: '🦅',
        categoria: 'Rapaz',
        imagen: 'imagenes/Aguilucho-negro.png'
    },

    3: { // Avoceta Andina
        nombre: 'Avoceta Andina',
        nombreCientifico: 'Recurvirostra andina',
        descripcion: 'Ave acuática de 40-45 cm con pico curvado característico. Su estado vulnerable requiere especial atención para su conservación en los humedales andinos.',
        habitat: 'Lagunas salinas y humedales altoandinos',
        tamaño: '40-45 cm',
        peso: '250-350 g',
        icono: '🦆',
        categoria: 'Acuática',
        estado: 'Vulnerable',
        imagen: 'imagenes/Avocetaandina.png'
    },

    4: { // Chorlito de Puna
        nombre: 'Chorlito de Puna',
        nombreCientifico: 'Charadrius alticola',
        descripcion: 'Ave pequeña que habita en la puna andina. Su población se mantiene estable y es común observarla en grupos cerca de cuerpos de agua.',
        habitat: 'Puna, bofedales y orillas de lagunas',
        tamaño: '18-20 cm',
        peso: '40-60 g',
        icono: '🐦',
        categoria: 'Limícola',
        estado: 'Estable',
        imagen: 'imagenes/Chorlito-puneño.jpg'
    },

    5: { // Pato Barcino
        nombre: 'Pato Barcino',
        nombreCientifico: 'Anas flavirostris oxyptera',
        descripcion: 'Pato que prefiere lagunas y tiene un estado poblacional estable. Es común en humedales andinos y se adapta bien a diferentes altitudes.',
        habitat: 'Lagunas, lagos y humedales',
        tamaño: '35-40 cm',
        peso: '400-600 g',
        icono: '🦆',
        categoria: 'Acuática',
        estado: 'Estable',
        imagen: 'imagenes/Pato-barcino.JPG'
    },

    6: { // Cigüeñuela
        nombre: 'Cigüeñuela',
        nombreCientifico: 'Himantopus mexicanus',
        descripcion: 'Ave zancuda con vuelo ágil y recto. Su peso ligero de 160-200g le permite maniobrar eficientemente sobre las aguas poco profundas.',
        habitat: 'Humedales, lagunas y pantanos',
        tamaño: '35-40 cm',
        peso: '160-200 g',
        icono: '🦩',
        categoria: 'Zancuda',
        imagen: 'imagenes/Cigueñela-Black.jpg'
    },

    7: { // Gallineta Común
        nombre: 'Gallineta Comun',
        nombreCientifico: 'Gallinula chloropus',
        descripcion: 'Ave acuática con vuelo corto y rápido. Su peso de 250-400g la hace ágil tanto en el agua como en tierra firme.',
        habitat: 'Lagunas con vegetación, pantanos',
        tamaño: '32-35 cm',
        peso: '250-400 g',
        icono: '🐦',
        categoria: 'Acuática',
        imagen: 'imagenes/Gallineta-comun.JPG'
    },

    8: { // Gallinula Morada
        nombre: 'Gallinula Morada',
        nombreCientifico: 'Porphyrio martinicus',
        descripcion: 'Ave de vuelo limitado pero con colorido espectacular usado para el cortejo. Su plumaje morado la hace inconfundible.',
        habitat: 'Humedales con vegetación densa',
        tamaño: '30-35 cm',
        peso: '200-300 g',
        icono: '🟣',
        categoria: 'Acuática',
        imagen: 'imagenes/Gallinulamorada.png'
    },

    9: { // Garceta Bueyera
        nombre: 'Garceta Bueyera',
        nombreCientifico: 'Bubulcus ibis',
        descripción: 'Garza con vuelo directo y comportamiento oportunista. Frecuentemente se asocia con ganado para alimentarse de insectos.',
        habitat: 'Pastizales, áreas ganaderas, humedales',
        tamaño: '46-56 cm',
        peso: '270-512 g',
        icono: '🦆',
        categoria: 'Zancuda',
        imagen: 'imagenes/Garza-bueyera.jpg'
    },

    10: { // Garceta Grande
        nombre: 'Garceta Grande',
        nombreCientifico: 'Ardea alba',
        descripcion: 'Garza de gran tamaño con vuelo elegante y técnicas de caza sigilosa. Es una de las garzas más grandes de la región.',
        habitat: 'Lagos, lagunas y humedales extensos',
        tamaño: '85-102 cm',
        peso: '700-1500 g',
        icono: '🦆',
        categoria: 'Zancuda',
        imagen: 'imagenes/Garza-grande.jpg'
    },

    11: { // Garza Nocturna
        nombre: 'Garza Nocturna',
        nombreCientifico: 'Nycticorax nycticorax',
        descripcion: 'Garza de hábitos nocturnos con ojos especialmente adaptados para la caza en condiciones de poca luz.',
        habitat: 'Humedales, lagos con vegetación',
        tamaño: '58-65 cm',
        peso: '727-1014 g',
        icono: '🌙',
        categoria: 'Zancuda',
        imagen: 'imagenes/Garzanocturna.png'
    },

    12: { // Gavilán Dorsirrojo
        nombre: 'Gavilan Dorsirrojo',
        nombreCientifico: 'Parabuteo unicinctus',
        descripcion: 'Ave rapaz conocida por su caza cooperativa y visión extremadamente aguda. Trabaja en grupos para capturar presas.',
        habitat: 'Zonas semiáridas, matorrales',
        tamaño: '46-76 cm',
        peso: '0.5-1.3 kg',
        icono: '🦅',
        categoria: 'Rapaz',
        imagen: 'imagenes/Gavilan-dorsirrojo.png'
    },

    13: { // Gaviota Andina
        nombre: 'Gaviota Andina',
        nombreCientifico: 'Chroicocephalus serranus',
        descripcion: 'Gaviota adaptada al frío andino con coloración que varía según la estación. Endémica de los Andes sudamericanos.',
        habitat: 'Lagos y lagunas altoandinas',
        tamaño: '42-48 cm',
        peso: '250-400 g',
        icono: '🕊️',
        categoria: 'Acuática',
        imagen: 'imagenes/Gaviota-andina.JPG'
    },

    14: { // Golondrina Andina
        nombre: 'Golondrina Andina',
        nombreCientifico: 'Orochelidon andecola',
        descripcion: 'Golondrina con vuelo rápido y gran adaptación a la altura. Migra siguiendo patrones estacionales en los Andes.',
        habitat: 'Valles andinos, quebradas',
        tamaño: '12-14 cm',
        peso: '10-15 g',
        icono: '🐦',
        categoria: 'Insectívora',
        imagen: 'imagenes/Golondrina-andina.png'
    },

    15: { // Huallata
        nombre: 'Huallata',
        nombreCientifico: 'Chloephaga melanoptera',
        descripcion: 'Ganso andino con sonido distintivo y comportamiento muy sociable. Forma grandes bandadas en época de reproducción.',
        habitat: 'Bofedales, puna húmeda',
        tamaño: '75-80 cm',
        peso: '2.5-3.2 kg',
        icono: '🦆',
        categoria: 'Acuática',
        imagen: 'imagenes/Wallata-Ganzo-andino.jpg'
    },

    16: { // Leke Leke
        nombre: 'Leke Leke',
        nombreCientifico: 'Vanellus resplendens',
        descripcion: 'Ave con vocalización muy fuerte y defensa activa de su territorio. Su nombre imita su llamado característico.',
        habitat: 'Pastizales, bofedales, puna',
        tamaño: '32-38 cm',
        peso: '140-200 g',
        icono: '🐦',
        categoria: 'Limícola',
        imagen: 'imagenes/Lequecho-Avefria-andina.JPG'
    },

    17: { // Minero de Puna
        nombre: 'Minero de Puna',
        nombreCientifico: 'Geositta punensis',
        descripcion: 'Ave principalmente terrestre que construye nidos en cuevas. Especialista en locomoción por el suelo de la puna.',
        habitat: 'Puna seca, laderas rocosas',
        tamaño: '14-16 cm',
        peso: '18-25 g',
        icono: '🐦',
        categoria: 'Insectívora',
        imagen: 'imagenes/Minero-puna.png'
    },

    18: { // Parihuana
        nombre: 'Parihuana',
        nombreCientifico: 'Phoenicoparrus andinus',
        descripcion: 'Flamenco filtrador natural cuya coloración rosada proviene de su dieta rica en carotenoides. Ave nacional del Perú.',
        habitat: 'Lagunas salinas altoandinas',
        tamaño: '102-110 cm',
        peso: '2.0-2.8 kg',
        icono: '🦩',
        categoria: 'Acuática',
        imagen: 'imagenes/Parihuana.png'
    },

    19: { // Parpadeo Andino
        nombre: 'Parpadeo Andino',
        nombreCientifico: 'Colaptes rupicola',
        descripcion: 'Carpintero especialista en hormigas con peso de 100-120g. Se alimenta principalmente de insectos que extrae de grietas rocosas.',
        habitat: 'Zonas rocosas, puna con arbustos',
        tamaño: '32-36 cm',
        peso: '100-120 g',
        icono: '🐦',
        categoria: 'Insectívora',
        imagen: 'imagenes/Carpintero-andino.JPG'
    },

    20: { // Pata Amarilla Menor
        nombre: 'Pata Amarilla Menor',
        nombreCientifico: 'Tringa flavipes',
        descripcion: 'Ave migratoria de gran resistencia que prefiere aguas someras. Realiza uno de los viajes más largos del reino animal.',
        habitat: 'Orillas de lagos, humedales',
        tamaño: '22-25 cm',
        peso: '67-94 g',
        icono: '🐦',
        categoria: 'Limícola',
        imagen: 'imagenes/Pata-amarilla-menor.png'
    },

    21: { // Pato Puna
        nombre: 'Pato Puna',
        nombreCientifico: 'Spatula puna',
        descripcion: 'Pato filtrador especialista en lagunas de altura. Perfectamente adaptado a las condiciones extremas de la puna andina.',
        habitat: 'Lagunas altoandinas, bofedales',
        tamaño: '45-48 cm',
        peso: '500-700 g',
        icono: '🦆',
        categoria: 'Acuática',
        imagen: 'imagenes/Pato-puna.JPG'
    },

    22: { // Pato Rana
        nombre: 'Pato Rana',
        nombreCientifico: 'Oxyura ferruginea',
        descripcion: 'Pato de alimentación acuática, discreto y poco visible. Excelente buceador que pasa la mayor parte del tiempo sumergido.',
        habitat: 'Lagos profundos, lagunas',
        tamaño: '35-43 cm',
        peso: '300-500 g',
        icono: '🦆',
        categoria: 'Acuática',
        imagen: 'imagenes/Pato-rana.JPG'
    },

    23: { // Pato Colorado
        nombre: 'Pato Colorado',
        nombreCientifico: 'Spatula cyanoptera',
        descripcion: 'Pato con coloración brillante pero difícil de observar debido a sus hábitos reservados. Los machos muestran colores intensos durante el cortejo.',
        habitat: 'Lagunas con vegetación, humedales',
        tamaño: '37-41 cm',
        peso: '250-400 g',
        icono: '🦆',
        categoria: 'Acuática',
        imagen: 'imagenes/pato_sutro2.jpg'
    },

    24: { // Pincha Flores de Garganta Negra
        nombre: 'Pincha Flores de Garganta Negra',
        nombreCientifico: 'Diglossa brunneiventris',
        descripcion: 'Ave con especialización alimentaria única en hábitat altoandino. Su pico está adaptado para extraer néctar perforando las flores.',
        habitat: 'Bosques nublados, matorrales andinos',
        tamaño: '12-13 cm',
        peso: '8-12 g',
        icono: '🌺',
        categoria: 'Nectarívora',
        imagen: 'imagenes/Pinchaflores-garganta-negra.png'
    },

    25: { // Pinzón Sierra Peruano
        nombre: 'Pinzon Sierra Peruano',
        nombreCientifico: 'Phrygilus punensis',
        descripcion: 'Ave granívora adaptada al frío extremo de la sierra. Su alimentación se basa principalmente en semillas de plantas altoandinas.',
        habitat: 'Puna, laderas rocosas',
        tamaño: '14-16 cm',
        peso: '15-25 g',
        icono: '🐦',
        categoria: 'Granívora',
        imagen: 'imagenes/Pinzón-sierra-peruano.png'
    },

    26: { // Rascón Plomizo
        nombre: 'Rascón Plomizo',
        nombreCientifico: 'Pardirallus sanguinolentus',
        descripcion: 'Ave difícil de avistar con dieta muy variada. Prefiere mantenerse oculta entre la vegetación densa de los humedales.',
        habitat: 'Totorales, humedales con vegetación',
        tamaño: '33-38 cm',
        peso: '350-500 g',
        icono: '🐦',
        categoria: 'Omnívora',
        imagen: 'imagenes/Rascónplomizo.png'
    },

    27: { // Zambullidor del Titicaca
        nombre: 'Zambullidor del Titicaca',
        nombreCientifico: 'Rollandia Microptera',
        descripcion: 'Ave endémica con alimentación subacuática y plumaje denso e impermeable. Especie emblemática del Lago Titicaca.',
        habitat: 'Lago Titicaca exclusivamente',
        tamaño: '40-45 cm',
        peso: '600-900 g',
        icono: '🦆',
        categoria: 'Acuática',
        estado: 'En peligro crítico',
        imagen: 'imagenes/Zambullidor.png'
    },

    28: { // Zampullín Plateado
        nombre: 'Zampullín Plateado',
        nombreCientifico: 'Podiceps Occipitalis',
        descripcion: 'Ave acuática con plumaje plateado distintivo. Es discreto pero curioso, a menudo se acerca a observar a los visitantes.',
        habitat: 'Lagos y lagunas andinas',
        tamaño: '26-30 cm',
        peso: '250-400 g',
        icono: '🦆',
        categoria: 'Acuática',
        imagen: 'imagenes/zampullin_plateado2.jpg'
    },

    29: { // Zarapito Picolargo
        nombre: 'Zarapito Picolargo',
        nombreCientifico: 'Numenius phaeopus',
        descripcion: 'Ave con alimentación especializada y gran resistencia para migraciones largas. Su pico curvado le permite explorar diferentes tipos de suelo.',
        habitat: 'Costas, humedales, pastizales',
        tamaño: '40-46 cm',
        peso: '270-493 g',
        icono: '🐦',
        categoria: 'Limícola',
        imagen: 'imagenes/Zarapito-picolargo.png'
    },
        // Nota: He incluido solo 3 especies para el ejemplo. 
        30: { // Ibis de la puna
    nombre: 'Ibis de la puna',
    nombreCientifico: 'Plegadis ridgwayi',
    descripcion: 'Ave de pico curvo, adaptada a zonas húmedas, con plumaje iridiscente que refleja distintos tonos según la luz.',
    habitat: 'Humedales altoandinos',
    tamaño: '60-70 cm',
    peso: '600-750 g',
    icono: '🪶',
    categoria: 'Ibis',
    imagen: 'imagenes/Puna-ibis.JPG'
},
        31: { // Totorero
            nombre: 'Totorero',
            nombreCientifico: 'Phleocryptes melanops',
            descripcion: 'Ave que habita en juncales, reconocida por su canto complejo y nidos colgantes entre las totoras.',
            habitat: 'Juncales, humedales',
            tamaño: '12-13 cm',
            peso: '9-12 g',
            icono: '🎶',
            categoria: 'Furnáridos',
            imagen: 'imagenes/Totorero.JPG'
        },
        32: { // Rascón plomizo
            nombre: 'Rascón plomizo',
            nombreCientifico: 'Pardirallus sanguinolentus',
            descripcion: 'Ave de hábitat palustre, con plumaje gris plomizo y pico largo adaptado para buscar alimento en zonas húmedas.',
            habitat: 'Humedales y pajonales',
            tamaño: '30-35 cm',
            peso: '200-300 g',
            icono: '🌿',
            categoria: 'Rálidos',
            imagen: 'imagenes/Rascon-plomizo.JPG'
        },
        33: { // Negrito
            nombre: 'Negrito',
            nombreCientifico: 'Lessonia oreas',
            descripcion: 'Ave de altitudes elevadas, con plumaje oscuro y adaptaciones para ambientes fríos y rocosos.',
            habitat: 'Zonas altoandinas',
            tamaño: '12-15 cm',
            peso: '15-20 g',
            icono: '⬛',
            categoria: 'Tiránidos',
            imagen: 'imagenes/Negrito.jpeg'
        },
        34: { // Gallareta andina
            nombre: 'Gallareta andina',
            nombreCientifico: 'Fulica ardesiaca',
            descripcion: 'Ave acuática de lagos altoandinos, con pico blanco y patas lobuladas que le permiten nadar con facilidad.',
            habitat: 'Lagos altoandinos',
            tamaño: '35-45 cm',
            peso: '400-700 g',
            icono: '⚪',
            categoria: 'Rálidos',
            imagen: 'imagenes/Gallareta-Andina.JPG'
        },
        35: { // Cernícalo americano
            nombre: 'Cernícalo americano',
            nombreCientifico: 'Falco sparverius',
            descripcion: 'Pequeño halcón con vuelo cernido, visión aguda y hábitos cazadores de insectos y pequeños vertebrados.',
            habitat: 'Campos abiertos y zonas urbanas',
            tamaño: '22-27 cm',
            peso: '80-165 g',
            icono: '🦅',
            categoria: 'Falconiformes',
            imagen: 'imagenes/Cernicalo-americano.JPG'
        },
        36: { // Paloma doméstica
            nombre: 'Paloma doméstica',
            nombreCientifico: 'Columba livia',
            descripcion: 'Ave ampliamente distribuida y adaptable a entornos urbanos, famosa por su capacidad de orientación.',
            habitat: 'Áreas urbanas y rurales',
            tamaño: '30-35 cm',
            peso: '250-380 g',
            icono: '🕊️',
            categoria: 'Colúmbidos',
            imagen: 'imagenes/Paloma-domestica.JPG'
        },
        37: { // Playero de Baird
            nombre: 'Playero de Baird',
            nombreCientifico: 'Calidris bairdii',
            descripcion: 'Ave migratoria que recorre largas distancias, se alimenta en playas arenosas y suele hacerlo en grupo.',
            habitat: 'Playas y humedales costeros',
            tamaño: '18-20 cm',
            peso: '40-50 g',
            icono: '🌊',
            categoria: 'Limícola',
            imagen: 'imagenes/Playero.jpeg'
        },
        38: { // Lechuza terrestre
            nombre: 'Lechuza terrestre',
            nombreCientifico: 'Athene cunicularia',
            descripcion: 'Ave rapaz nocturna que anida en madrigueras, con plumaje críptico y excelente visión nocturna.',
            habitat: 'Praderas, zonas áridas',
            tamaño: '23-28 cm',
            peso: '150-250 g',
            icono: '🦉',
            categoria: 'Estrígidos',
            imagen: 'imagenes/Lechuza-terrestre.jpeg'
        },
        39: { // Bailarín chico
            nombre: 'Bailarín chico',
            nombreCientifico: 'Anthus furcatus',
            descripcion: 'Ave pequeña de tierras abiertas, con pico corto y plumaje que le da camuflaje.',
            habitat: 'Praderas y pastizales',
            tamaño: '14-16 cm',
            peso: '20-25 g',
            icono: '🎵',
            categoria: 'Motacílidos',
            imagen: 'imagenes/Bailarin-chico.jpg'
        },
        40: { // Pato jergón
            nombre: 'Pato jergón',
            nombreCientifico: 'Anas georgica',
            descripcion: 'Pato migratorio de hábitat acuático, con pico amarillo y gran adaptabilidad a lagunas altoandinas.',
            habitat: 'Lagos, lagunas y ríos',
            tamaño: '45-56 cm',
            peso: '500-800 g',
            icono: '🦆',
            categoria: 'Anátidos',
            imagen: 'imagenes/Pato-gergon.jpg'
        },
        41: { // Varillero ala amarilla (macho)
            nombre: 'Varillero ala amarilla (macho)',
            nombreCientifico: 'Agelasticus thilius',
            descripcion: 'Ave de plumaje negro con alas amarillas muy visibles; los machos suelen ser territoriales.',
            habitat: 'Humedales y pantanos',
            tamaño: '18-20 cm',
            peso: '35-40 g',
            icono: '💛',
            categoria: 'Ictéridos',
            imagen: 'imagenes/agelasticus-thilius.jpeg'
        },
        42: { // Varillero ala amarilla (hembra)
            nombre: 'Varillero ala amarilla (hembra)',
            nombreCientifico: 'Agelasticus thilius',
            descripcion: 'Ave con alas amarillas y canto melodioso; la hembra presenta plumaje más críptico y adaptado al entorno.',
            habitat: 'Humedales y pantanos',
            tamaño: '17-19 cm',
            peso: '30-38 g',
            icono: '💛',
            categoria: 'Ictéridos',
            imagen: 'imagenes/Varillero-ala-amarilla.JPG'
        }
    };

    // Variables del juego mejoradas
    let currentBirdId = null;
    let score = 0;
    let sessionScore = 0; // Puntuación de la sesión actual
    let correctAnswers = 0;
    let hintsUsed = 0;
    let currentStreak = 0;
    let maxStreak = 0;
    let difficulty = 'easy';
    let availableClues = 4;
    let gameActive = false;
    let totalGames = 0;
    let imageRevealed = false;
    let imageRevealUsed = false; // Controla si ya se usó el botón revelar
    let startTime = null;
    let soundEnabled = true;
    let playerName = '';
    let clueTimers = []; // Para manejar los temporizadores de pistas

    // Sistema de almacenamiento de puntuaciones
    class ScoreManager {
        static getLeaderboard(difficulty) {
            const key = `leaderboard_${difficulty}`;
            return JSON.parse(localStorage.getItem(key)) || [];
        }

        static saveScore(playerName, score, difficulty) {
            if (score <= 0) return; // No guardar puntuaciones de 0
            
            const leaderboard = this.getLeaderboard(difficulty);
            
            // Buscar si el jugador ya existe
            const existingIndex = leaderboard.findIndex(entry => entry.name === playerName);
            
            if (existingIndex >= 0) {
                // Actualizar si es mejor puntuación
                if (score > leaderboard[existingIndex].score) {
                    leaderboard[existingIndex].score = score;
                    leaderboard[existingIndex].date = new Date().toLocaleDateString();
                }
            } else {
                // Agregar nuevo jugador
                leaderboard.push({
                    name: playerName,
                    score: score,
                    date: new Date().toLocaleDateString()
                });
            }
            
            // Ordenar por puntuación y mantener solo top 10
            leaderboard.sort((a, b) => b.score - a.score);
            const topLeaderboard = leaderboard.slice(0, 10);
            
            localStorage.setItem(`leaderboard_${difficulty}`, JSON.stringify(topLeaderboard));
            this.updateLeaderboardDisplay();
        }

        static updateLeaderboardDisplay() {
            const leaderboard = this.getLeaderboard(difficulty);
            const leaderboardList = document.getElementById('leaderboardList');
            const leaderboardTitle = document.getElementById('leaderboardTitle');
            
            leaderboardTitle.textContent = `Top Jugadores - ${difficulty === 'easy' ? 'Fácil' : difficulty === 'medium' ? 'Medio' : 'Difícil'}`;
            
            if (leaderboard.length === 0) {
                leaderboardList.innerHTML = '<div style="text-align: center; color: #64748b;">No hay puntuaciones aún</div>';
                return;
            }
            
            leaderboardList.innerHTML = leaderboard.map((entry, index) => `
                <div class="leaderboard-item ${entry.name === playerName ? 'current' : ''}">
                    <span>#${index + 1} ${entry.name}</span>
                    <span>${entry.score} pts</span>
                </div>
            `).join('');
        }
    }

    // Elementos del DOM
    const birdImageElement = document.getElementById('bird-image');
    const optionsContainer = document.getElementById('options-container');
    const feedbackElement = document.getElementById('feedback');
    const scoreElement = document.getElementById('score');
    const correctAnswersElement = document.getElementById('correct-answers');
    const hintsUsedElement = document.getElementById('hints-used');
    const streakElement = document.getElementById('streak');
    const hintButton = document.getElementById('hint-btn');
    const revealBtn = document.getElementById('revealBtn');

    // Sistema de sonidos (usando Web Audio API)
    class GameSounds {
        constructor() {
            this.audioContext = null;
            this.enabled = true;
            this.initAudio();
        }

        initAudio() {
            try {
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Audio no disponible');
                this.enabled = false;
            }
        }

        playSound(frequency, duration, type = 'sine') {
            if (!this.enabled || !this.audioContext) return;

            const oscillator = this.audioContext.createOscillator();
            const gainNode = this.audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(this.audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
            
            oscillator.start(this.audioContext.currentTime);
            oscillator.stop(this.audioContext.currentTime + duration);
        }

        correct() {
            this.playSound(523.25, 0.2); // C5
            setTimeout(() => this.playSound(659.25, 0.3), 100); // E5
            setTimeout(() => this.playSound(783.99, 0.4), 200); // G5
        }

        incorrect() {
            this.playSound(220, 0.5, 'sawtooth'); // A3
        }

        hint() {
            this.playSound(440, 0.2); // A4
        }

        newGame() {
            this.playSound(330, 0.1);
            setTimeout(() => this.playSound(440, 0.1), 50);
        }
    }

    const gameSounds = new GameSounds();

    // Sistema de partículas para efectos visuales
    class ParticleSystem {
        static createParticles(element, count = 12) {
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const angle = (i / count) * Math.PI * 2;
                const distance = 50 + Math.random() * 50;
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                particle.style.setProperty('--x', x + 'px');
                particle.style.setProperty('--y', y + 'px');
                particle.style.animationDelay = Math.random() * 0.2 + 's';
                
                document.body.appendChild(particle);
                
                setTimeout(() => particle.remove(), 1000);
            }
        }
    }

    // Inicializar el juego
    function initGame() {
        // Mostrar modal para nombre del jugador
        document.getElementById('playerModal').style.display = 'flex';
        updateStats();
        addKeyboardListeners();
        preloadImages();
        ScoreManager.updateLeaderboardDisplay();
    }

    // Comenzar juego después de ingresar nombre
    function startGame() {
        const nameInput = document.getElementById('playerName');
        const name = nameInput.value.trim();
        
        if (name.length < 2) {
            alert('Por favor ingresa un nombre de al menos 2 caracteres');
            return;
        }
        
        playerName = name;
        document.getElementById('playerModal').style.display = 'none';
        gameActive = true;
        nextBird();
    }

    // Precargar imágenes para mejor rendimiento
    function preloadImages() {
        Object.values(avesData).forEach(bird => {
            if (bird.imagen) {
                const img = new Image();
                img.src = bird.imagen;
            }
        });
    }

    // Añadir listeners para teclado
    function addKeyboardListeners() {
        document.addEventListener('keydown', (e) => {
            if (!gameActive) return;
            
            const key = e.key;
            if (key >= '1' && key <= '6') {
                const index = parseInt(key) - 1;
                const options = document.querySelectorAll('.option');
                if (options[index]) {
                    options[index].click();
                }
            } else if (key === ' ') {
                e.preventDefault();
                nextBird();
            } else if (key === 'h' || key === 'H') {
                useHint();
            } else if (key === 'r' || key === 'R') {
                revealImage();
            }
        });

        // Enter en el modal de nombre
        document.getElementById('playerName').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                startGame();
            }
        });
    }

    // Seleccionar un ave aleatoria y configurar el juego
    function nextBird() {
        if (!gameActive) return;
        
        // Limpiar temporizadores anteriores
        clueTimers.forEach(timer => clearTimeout(timer));
        clueTimers = [];
        
        // Reiniciar estado
        resetGameUI();
        gameSounds.newGame();
        
        // Seleccionar un ave aleatoria diferente a la anterior
        const birdIds = Object.keys(avesData);
        let newBirdId;
        do {
            newBirdId = birdIds[Math.floor(Math.random() * birdIds.length)];
        } while (newBirdId === currentBirdId && birdIds.length > 1);
        
        currentBirdId = newBirdId;
        const currentBird = avesData[currentBirdId];
        
        // Configurar la imagen con animación
        setupBirdImage(currentBird);
        
        // Mostrar pistas con animación
        showClues(currentBird);
        
        // Generar opciones de respuesta
        generateOptions(currentBird);
        
        // Actualizar feedback
        feedbackElement.textContent = "¡Selecciona una opción para adivinar!";
        feedbackElement.className = "feedback info";
        
        // Iniciar cronómetro
        startTime = Date.now();
        totalGames++;
    }

    // Configurar imagen del ave
    function setupBirdImage(bird) {
        birdImageElement.classList.add('loading');
        
        if (bird.imagen) {
            const img = new Image();
            img.onload = () => {
                birdImageElement.style.backgroundImage = `url(${bird.imagen})`;
                birdImageElement.style.backgroundSize = 'cover';
                birdImageElement.style.backgroundPosition = 'center';
                birdImageElement.innerHTML = '';
                birdImageElement.classList.remove('loading');
            };
            img.onerror = () => {
                // Fallback al icono si la imagen no carga
                birdImageElement.style.backgroundImage = '';
                birdImageElement.innerHTML = bird.icono;
                birdImageElement.classList.remove('loading');
            };
            img.src = bird.imagen;
        } else {
            birdImageElement.style.backgroundImage = '';
            birdImageElement.innerHTML = bird.icono;
            birdImageElement.classList.remove('loading');
        }
        
        birdImageElement.classList.add('blurred');
        imageRevealed = false;
        imageRevealUsed = false;
        revealBtn.classList.remove('used');
        revealBtn.textContent = 'Revelar Imagen';
    }

    // Mostrar las pistas del ave con animación y temporizador
    function showClues(bird) {
        availableClues = 4;
        
        const clues = [
            `Categoría: ${bird.categoria}`,
            `Tamaño: ${bird.tamaño}`,
            `Hábitat: ${bird.habitat}`,
            bird.dato_curioso ? `Dato curioso: ${bird.dato_curioso}` : `Peso: ${bird.peso}`
        ];
        
        clues.forEach((clueText, index) => {
            const clueElement = document.getElementById(`clue-${index + 1}`);
            const textElement = document.getElementById(`clue-${index + 1}-text`);
            
            textElement.textContent = clueText;
            clueElement.classList.remove('revealed', 'countdown');
            
            if (index === 0) {
                setTimeout(() => {
                    clueElement.classList.add('revealed');
                }, 300);
            }
        });
        
        updateHintButton();
    }

    // Usar una pista adicional con efectos mejorados y temporizador
    function useHint() {
        if (availableClues <= 1 || !gameActive) return;
        
        gameSounds.hint();
        
        // Revelar la siguiente pista con animación
        const nextClueId = 5 - availableClues;
        const nextClueElement = document.getElementById(`clue-${nextClueId}`);
        
        setTimeout(() => {
            nextClueElement.classList.add('revealed', 'countdown');
            
            // Iniciar temporizador de 10 segundos para ocultar la pista
            const timer = setTimeout(() => {
                nextClueElement.classList.remove('revealed', 'countdown');
            }, 10000);
            
            clueTimers.push(timer);
        }, 200);
        
        availableClues--;
        hintsUsed++;
        updateStats();
        updateHintButton();
        
        // Vibración táctil si está disponible
        if ('vibrate' in navigator) {
            navigator.vibrate(50);
        }
    }

    // Actualizar estado del botón de pista
    function updateHintButton() {
        const canUseHint = availableClues > 1 && gameActive;
        hintButton.disabled = !canUseHint;
        hintButton.textContent = canUseHint ? 
            `Usar Pista (${4 - availableClues}/3)` : 
            'Sin pistas';
    }

    // Revelar la imagen con efectos (solo una vez por ave)
    function revealImage() {
        if (imageRevealed || imageRevealUsed) return;
        
        birdImageElement.classList.remove('blurred');
        imageRevealed = true;
        imageRevealUsed = true;
        
        // Cambiar estado del botón
        revealBtn.classList.add('used');
        revealBtn.textContent = 'Imagen Revelada';
        
        // Vibración táctil si está disponible
        if ('vibrate' in navigator) {
            navigator.vibrate(100);
        }
    }

    // Generar opciones de respuesta con mejor distribución
    function generateOptions(correctBird) {
        optionsContainer.innerHTML = '';
        const birdIds = Object.keys(avesData);
        let options = [correctBird.nombre];
        
        // Determinar número de opciones según la dificultad
        let numOptions;
        switch(difficulty) {
            case 'easy': numOptions = 3; break;
            case 'medium': numOptions = 4; break;
            case 'hard': numOptions = 6; break;
            default: numOptions = 3;
        }
        
        numOptions = Math.min(numOptions, birdIds.length);
        
        // Añadir opciones incorrectas, priorizando aves de la misma categoría
        const sameCategoryBirds = birdIds.filter(id => 
            id !== currentBirdId && avesData[id].categoria === correctBird.categoria
        );
        
        const otherBirds = birdIds.filter(id => 
            id !== currentBirdId && avesData[id].categoria !== correctBird.categoria
        );
        
        // Mezclar las listas
        const shuffledSame = shuffleArray([...sameCategoryBirds]);
        const shuffledOther = shuffleArray([...otherBirds]);
        const allIncorrect = [...shuffledSame, ...shuffledOther];
        
        // Añadir opciones incorrectas hasta completar
        while (options.length < numOptions && allIncorrect.length > 0) {
            const randomBirdId = allIncorrect.shift();
            options.push(avesData[randomBirdId].nombre);
        }
        
        // Mezclar las opciones
        options = shuffleArray(options);
        
        // Crear botones para cada opción con animación escalonada
        options.forEach((option, index) => {
            const optionElement = document.createElement('div');
            optionElement.className = 'option';
            optionElement.textContent = option;
            optionElement.style.animationDelay = (index * 0.1) + 's';
            optionElement.addEventListener('click', () => checkAnswer(option, correctBird.nombre));
            
            // Añadir número para acceso por teclado
            optionElement.setAttribute('data-key', (index + 1).toString());
            
            optionsContainer.appendChild(optionElement);
        });
        
        // Actualizar grid según número de opciones
        const columns = numOptions <= 2 ? numOptions : 2;
        optionsContainer.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
    }

    // Comprobar la respuesta seleccionada con efectos mejorados
    function checkAnswer(selectedOption, correctAnswer) {
        if (!gameActive) return;
        
        gameActive = false;
        const endTime = Date.now();
        const responseTime = (endTime - startTime) / 1000;
        
        // Limpiar temporizadores de pistas
        clueTimers.forEach(timer => clearTimeout(timer));
        clueTimers = [];
        
        const options = document.querySelectorAll('.option');
        let selectedElement = null;
        let correctElement = null;
        
        options.forEach(option => {
            if (option.textContent === correctAnswer) {
                option.classList.add('correct');
                correctElement = option;
            } else if (option.textContent === selectedOption) {
                option.classList.add('incorrect');
                selectedElement = option;
            }
            option.style.pointerEvents = 'none';
        });
        
        if (selectedOption === correctAnswer) {
            // Respuesta correcta
            gameSounds.correct();
            ParticleSystem.createParticles(correctElement);
            
            feedbackElement.innerHTML = `
                <div>¡Correcto! Has adivinado el ave.</div>
                <small>Tiempo: ${responseTime.toFixed(1)}s</small>
            `;
            feedbackElement.className = "feedback success";
            
            const points = calculatePoints(responseTime);
            score += points;
            sessionScore += points;
            correctAnswers++;
            currentStreak++;
            maxStreak = Math.max(maxStreak, currentStreak);
            
            // Revelar la imagen automáticamente
            setTimeout(() => {
                birdImageElement.classList.remove('blurred');
                imageRevealed = true;
            }, 800);
            
            // Mostrar información adicional
            setTimeout(() => showBirdInfo(), 1500);
            
        } else {
            // Respuesta incorrecta
            gameSounds.incorrect();
            feedbackElement.innerHTML = `
                <div>Incorrecto. La respuesta correcta era: <strong>${correctAnswer}</strong></div>
                <small>Tiempo: ${responseTime.toFixed(1)}s</small>
            `;
            feedbackElement.className = "feedback error";
            currentStreak = 0;
            
            // Revelar la imagen y mostrar info
            setTimeout(() => {
                birdImageElement.classList.remove('blurred');
                imageRevealed = true;
                showBirdInfo();
            }, 1000);
        }
        
        updateStats();
        updateHintButton();
        
        // Guardar puntuación después de cada respuesta
        ScoreManager.saveScore(playerName, score, difficulty);
        
        // Activar el juego después de 3 segundos para la siguiente pregunta
        setTimeout(() => {
            gameActive = true;
        }, 3000);
    }

    // Mostrar información adicional del ave
    function showBirdInfo() {
        const currentBird = avesData[currentBirdId];
        const infoHtml = `
            <div style="margin-top: 15px; padding: 15px; background: rgba(248, 250, 252, 0.8); border-radius: 12px; text-align: left; font-size: 14px;">
                <strong>${currentBird.nombreCientifico}</strong><br>
                ${currentBird.descripcion}
                ${currentBird.estado ? `<br><em>Estado: ${currentBird.estado}</em>` : ''}
            </div>
        `;
        feedbackElement.innerHTML += infoHtml;
    }

    // Calcular puntos con bonificaciones por tiempo y racha
    function calculatePoints(responseTime) {
        let basePoints;
        switch(difficulty) {
            case 'easy': basePoints = 10; break;
            case 'medium': basePoints = 20; break;
            case 'hard': basePoints = 30; break;
            default: basePoints = 10;
        }
        
        // Penalización por pistas usadas
        const cluePenalty = (4 - availableClues) * 3;
        
        // Bonificación por tiempo (máximo 10 puntos extra)
        const timeBonus = Math.max(0, Math.min(10, Math.floor((10 - responseTime) * 2)));
        
        // Bonificación por racha
        const streakBonus = Math.min(currentStreak * 2, 20);
        
        // Penalización por imagen revelada
        const imagePenalty = imageRevealUsed ? 5 : 0;
        
        const finalPoints = Math.max(basePoints - cluePenalty + timeBonus + streakBonus - imagePenalty, 5);
        
        return finalPoints;
    }

    // Reiniciar la interfaz para una nueva ronda
    function resetGameUI() {
        birdImageElement.classList.add('blurred');
        birdImageElement.style.backgroundImage = '';
        birdImageElement.innerHTML = '🐦';
        optionsContainer.innerHTML = '';
        feedbackElement.textContent = '';
        feedbackElement.className = 'feedback';
        imageRevealed = false;
        imageRevealUsed = false;
        
        // Resetear botón de revelar
        revealBtn.classList.remove('used');
        revealBtn.textContent = 'Revelar Imagen';
        
        // Resetear pistas
        for (let i = 1; i <= 4; i++) {
            const clueElement = document.getElementById(`clue-${i}`);
            clueElement.classList.remove('revealed', 'countdown');
        }
    }

    // Actualizar estadísticas con animaciones
    function updateStats() {
        animateStatChange(scoreElement, score);
        animateStatChange(correctAnswersElement, correctAnswers);
        animateStatChange(hintsUsedElement, hintsUsed);
        animateStatChange(streakElement, currentStreak);
    }

    // Animar cambio de estadística
    function animateStatChange(element, newValue) {
        const currentValue = parseInt(element.textContent) || 0;
        if (currentValue !== newValue) {
            element.style.transform = 'scale(1.2)';
            setTimeout(() => {
                element.textContent = newValue;
                element.style.transform = 'scale(1)';
            }, 150);
        }
    }

    // Establecer dificultad con efectos
    function setDifficulty(level) {
        difficulty = level;
        
        // Actualizar botones de dificultad
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // Actualizar leaderboard
        ScoreManager.updateLeaderboardDisplay();
        
        // Reiniciar juego con nueva dificultad si está activo
        if (gameActive) {
            nextBird();
        }
        
        // Vibración táctil
        if ('vibrate' in navigator) {
            navigator.vibrate(30);
        }
    }

    // Toggle del leaderboard
    function toggleLeaderboard() {
        const leaderboard = document.getElementById('leaderboard');
        leaderboard.classList.toggle('hidden');
    }

    // Función para mezclar array (Fisher-Yates mejorada)
    function shuffleArray(array) {
        const newArray = [...array];
        for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
        }
        return newArray;
    }

    // Sistema de logros y notificaciones
    class AchievementSystem {
        static achievements = [
            { id: 'first_correct', name: 'Primer Acierto', description: 'Responde correctamente por primera vez', threshold: 1 },
            { id: 'streak_5', name: 'Racha de 5', description: 'Consigue 5 respuestas correctas seguidas', threshold: 5 },
            { id: 'speed_demon', name: 'Demonio de la Velocidad', description: 'Responde en menos de 3 segundos', threshold: 1 },
            { id: 'expert', name: 'Experto en Aves', description: 'Consigue 20 respuestas correctas', threshold: 20 }
        ];
        
        static unlockedAchievements = new Set();
        
        static checkAchievements() {
            // Verificar logros basados en estadísticas actuales
            this.checkAchievement('first_correct', correctAnswers >= 1);
            this.checkAchievement('streak_5', currentStreak >= 5);
            this.checkAchievement('expert', correctAnswers >= 20);
        }
        
        static checkAchievement(id, condition) {
            if (condition && !this.unlockedAchievements.has(id)) {
                this.unlockAchievement(id);
            }
        }
        
        static unlockAchievement(id) {
            const achievement = this.achievements.find(a => a.id === id);
            if (!achievement) return;
            
            this.unlockedAchievements.add(id);
            this.showAchievementNotification(achievement);
        }
        
        static showAchievementNotification(achievement) {
            const notification = document.createElement('div');
            notification.className = 'achievement-notification';
            notification.innerHTML = `
                <div style="
                    position: fixed;
                    top: 20px;
                    left: 20px;
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 12px;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                    z-index: 1000;
                    animation: slideInLeft 0.5s ease-out;
                    max-width: 300px;
                ">
                    <strong>🏆 Logro Desbloqueado!</strong><br>
                    <span style="font-size: 14px;">${achievement.name}</span><br>
                    <small>${achievement.description}</small>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutLeft 0.5s ease-in forwards';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
    }

    // Inicializar el juego cuando se cargue la página
    window.addEventListener('load', () => {
        initGame();
        
        // Añadir estilos para logros
        const achievementStyles = document.createElement('style');
        achievementStyles.textContent = `
            @keyframes slideInLeft {
                from { transform: translateX(-100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOutLeft {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(-100%); opacity: 0; }
            }
        `;
        document.head.appendChild(achievementStyles);
        
        // Cerrar leaderboard al hacer clic fuera
        document.addEventListener('click', (e) => {
            const leaderboard = document.getElementById('leaderboard');
            const toggleBtn = document.querySelector('.leaderboard-toggle');
            
            if (!leaderboard.contains(e.target) && e.target !== toggleBtn && !leaderboard.classList.contains('hidden')) {
                leaderboard.classList.add('hidden');
            }
        });
    });

    // Verificar logros después de cada respuesta
    const originalCheckAnswer = checkAnswer;
    checkAnswer = function(selectedOption, correctAnswer) {
        originalCheckAnswer(selectedOption, correctAnswer);
        setTimeout(() => AchievementSystem.checkAchievements(), 500);
    };

    // Hacer que las funciones estén disponibles globalmente
    window.nextBird = nextBird;
    window.useHint = useHint;
    window.revealImage = revealImage;
    window.setDifficulty = setDifficulty;
    window.startGame = startGame;
    window.toggleLeaderboard = toggleLeaderboard;

    // Función para reiniciar completamente el juego
    function resetCompleteGame() {
        // Guardar puntuación final
        if (score > 0) {
            ScoreManager.saveScore(playerName, score, difficulty);
        }
        
        // Reiniciar todas las variables
        score = 0;
        sessionScore = 0;
        correctAnswers = 0;
        hintsUsed = 0;
        currentStreak = 0;
        maxStreak = 0;
        totalGames = 0;
        
        // Actualizar estadísticas
        updateStats();
        
        // Mostrar modal para nuevo jugador o continuar
        const continueGame = confirm(`¡Juego terminado!\n\nPuntuación final: ${sessionScore} puntos\n¿Quieres jugar otra vez?`);
        
        if (continueGame) {
            document.getElementById('playerModal').style.display = 'flex';
            document.getElementById('playerName').value = playerName; // Mantener el nombre anterior
        }
    }

    // Agregar botón para reiniciar juego completo
    document.addEventListener('DOMContentLoaded', () => {
        const resetButton = document.createElement('button');
        resetButton.textContent = 'Nuevo Juego';
        resetButton.className = 'btn-secondary';
        resetButton.style.position = 'fixed';
        resetButton.style.bottom = '20px';
        resetButton.style.left = '20px';
        resetButton.style.zIndex = '1000';
        resetButton.onclick = resetCompleteGame;
        
        document.body.appendChild(resetButton);
    });

    // Función para manejar salida de pantalla completa o cierre de ventana
    window.addEventListener('beforeunload', () => {
        if (score > 0) {
            ScoreManager.saveScore(playerName, score, difficulty);
        }
    });

    // Agregar indicador visual de tiempo para las pistas
    function addClueTimer(clueElement) {
        const timerBar = document.createElement('div');
        timerBar.style.cssText = `
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 100%;
            transform-origin: left;
            animation: shrinkTimer 10s linear forwards;
        `;
        
        const timerKeyframes = `
            @keyframes shrinkTimer {
                from { transform: scaleX(1); }
                to { transform: scaleX(0); }
            }
        `;
        
        if (!document.getElementById('timer-styles')) {
            const style = document.createElement('style');
            style.id = 'timer-styles';
            style.textContent = timerKeyframes;
            document.head.appendChild(style);
        }
        
        clueElement.style.position = 'relative';
        clueElement.appendChild(timerBar);
        
        return timerBar;
    }

    // Mejorar la función useHint para incluir el indicador visual
    const originalUseHint = useHint;
    useHint = function() {
        if (availableClues <= 1 || !gameActive) return;
        
        gameSounds.hint();
        
        // Revelar la siguiente pista con animación
        const nextClueId = 5 - availableClues;
        const nextClueElement = document.getElementById(`clue-${nextClueId}`);
        
        setTimeout(() => {
            nextClueElement.classList.add('revealed', 'countdown');
            
            // Agregar barra de tiempo visual
            const timerBar = addClueTimer(nextClueElement);
            
            // Iniciar temporizador de 10 segundos para ocultar la pista
            const timer = setTimeout(() => {
                nextClueElement.classList.remove('revealed', 'countdown');
                if (timerBar && timerBar.parentNode) {
                    timerBar.remove();
                }
            }, 10000);
            
            clueTimers.push(timer);
        }, 200);
        
        availableClues--;
        hintsUsed++;
        updateStats();
        updateHintButton();
        
        // Vibración táctil si está disponible
        if ('vibrate' in navigator) {
            navigator.vibrate(50);
        }
    };
</script>

</body>
</html>